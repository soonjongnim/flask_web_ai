<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Sample default.css</title>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<link type="text/css" rel="stylesheet" href="static/css/style.css">
    <style>
      select, ul { height: 100px; overflow: auto; width: 200px; border: 1px solid #000; }
      ul { list-style-type: none; margin: 0; padding: 0; overflow-x: hidden; background-color: white; }
      li { margin: 0; padding: 0; }
      label { display: block; color: WindowText; background-color: Window; margin: 0; padding: 0; width: 100%; }
      /* label:hover { background-color: Highlight; color: HighlightText; } */
    </style>
	</head>
	<body>
    <h1>영상음성을 원하는 자막으로 변환</h1>
    <form>
      <label for="video-url">영상주소:</label>
      <input type="text" id="video-url" name="video-url"><br><br>
      <label for="language">변환 자막:</label>
      <table cellpadding="0" cellspacing="0" style="cursor:pointer" onClick="multiSelect('OPEN')">
        <tr>
          <td align="center" width="200" style="border:1px solid;font-size:12px;">자막 언어 선택</td>
          <td><input type="button" value="▼" onclick=""></td>
        </tr>
      </table>
  
      <div id="Div" style="position:absolute;visibility:hidden;font-size:12px;">
        <ul>
          <li><input type="checkbox" name="mycheckbox" id="afrikaans">afrikaans</li>
          <li><input type="checkbox" name="mycheckbox" id="albanian">albanian</li>
          <li><input type="checkbox" name="mycheckbox" id="am">amharic</li>
          <li><input type="checkbox" name="mycheckbox" id="ar">arabic</li>
          <li><input type="checkbox" name="mycheckbox" id="hy">armenian</li>
          <li><input type="checkbox" name="mycheckbox" id="az">azerbaijani</li>
          <li><input type="checkbox" name="mycheckbox" id="eu">basque</li>
          <li><input type="checkbox" name="mycheckbox" id="be">belarusian</li>
          <li><input type="checkbox" name="mycheckbox" id="bn">bengali</li>
          <li><input type="checkbox" name="mycheckbox" id="bs">bosnian</li>
          <li><input type="checkbox" name="mycheckbox" id="bg">bulgarian</li>
          <li><input type="checkbox" name="mycheckbox" id="ca">catalan</li>
          <li><input type="checkbox" name="mycheckbox" id="ceb">cebuano</li>
          <li><input type="checkbox" name="mycheckbox" id="ny">chichewa</li>
          <li><input type="checkbox" name="mycheckbox" id="chinese">chinese (simplified)</li>
          <li><input type="checkbox" name="mycheckbox" id="zh-tw">chinese (traditional)</li>
          <li><input type="checkbox" name="mycheckbox" id="co">corsican</li>
          <li><input type="checkbox" name="mycheckbox" id="hr">croatian</li>
          <li><input type="checkbox" name="mycheckbox" id="cs">czech</li>
          <li><input type="checkbox" name="mycheckbox" id="da">danish</li>
          <li><input type="checkbox" name="mycheckbox" id="nl">dutch</li>
          <li><input type="checkbox" name="mycheckbox" id="english">english</li>
          <li><input type="checkbox" name="mycheckbox" id="eo">esperanto</li>
          <li><input type="checkbox" name="mycheckbox" id="et">estonian</li>
          <li><input type="checkbox" name="mycheckbox" id="tl">filipino</li>
          <li><input type="checkbox" name="mycheckbox" id="fi">finnish</li>
          <li><input type="checkbox" name="mycheckbox" id="fr">french</li>
          <li><input type="checkbox" name="mycheckbox" id="fy">frisian</li>
          <li><input type="checkbox" name="mycheckbox" id="gl">galician</li>
          <li><input type="checkbox" name="mycheckbox" id="ka">georgian</li>
          <li><input type="checkbox" name="mycheckbox" id="de">german</li>
          <li><input type="checkbox" name="mycheckbox" id="el">greek</li>
          <li><input type="checkbox" name="mycheckbox" id="gu">gujarati</li>
          <li><input type="checkbox" name="mycheckbox" id="ht">haitian creole</li>
          <li><input type="checkbox" name="mycheckbox" id="ha">hausa</li>
          <li><input type="checkbox" name="mycheckbox" id="haw">hawaiian</li>
          <li><input type="checkbox" name="mycheckbox" id="iw">hebrew</li>
          <li><input type="checkbox" name="mycheckbox" id="he">hebrew</li>
          <li><input type="checkbox" name="mycheckbox" id="hi">hindi</li>
          <li><input type="checkbox" name="mycheckbox" id="hmn">hmong</li>
          <li><input type="checkbox" name="mycheckbox" id="hu">hungarian</li>
          <li><input type="checkbox" name="mycheckbox" id="is">icelandic</li>
          <li><input type="checkbox" name="mycheckbox" id="ig">igbo</li>
          <li><input type="checkbox" name="mycheckbox" id="id">indonesian</li>
          <li><input type="checkbox" name="mycheckbox" id="ga">irish</li>
          <li><input type="checkbox" name="mycheckbox" id="it">italian</li>
          <li><input type="checkbox" name="mycheckbox" id="japanese">japanese</li>
          <li><input type="checkbox" name="mycheckbox" id="jw">javanese</li>
          <li><input type="checkbox" name="mycheckbox" id="kn">kannada</li>
          <li><input type="checkbox" name="mycheckbox" id="kk">kazakh</li>
          <li><input type="checkbox" name="mycheckbox" id="km">khmer</li>
          <li><input type="checkbox" name="mycheckbox" id="korean">korean</li>
          <li><input type="checkbox" name="mycheckbox" id="ku">kurdish (kurmanji)</li>
          <li><input type="checkbox" name="mycheckbox" id="ky">kyrgyz</li>
          <li><input type="checkbox" name="mycheckbox" id="lo">lao</li>
          <li><input type="checkbox" name="mycheckbox" id="la">latin</li>
          <li><input type="checkbox" name="mycheckbox" id="lv">latvian</li>
          <li><input type="checkbox" name="mycheckbox" id="lt">lithuanian</li>
          <li><input type="checkbox" name="mycheckbox" id="lb">luxembourgish</li>
          <li><input type="checkbox" name="mycheckbox" id="mk">macedonian</li>
          <li><input type="checkbox" name="mycheckbox" id="mg">malagasy</li>
          <li><input type="checkbox" name="mycheckbox" id="ms">malay</li>
          <li><input type="checkbox" name="mycheckbox" id="ml">malayalam</li>
          <li><input type="checkbox" name="mycheckbox" id="mt">maltese</li>
          <li><input type="checkbox" name="mycheckbox" id="mi">maori</li>
          <li><input type="checkbox" name="mycheckbox" id="mr">marathi</li>
          <li><input type="checkbox" name="mycheckbox" id="mn">mongolian</li>
          <li><input type="checkbox" name="mycheckbox" id="my">myanmar (burmese)</li>
          <li><input type="checkbox" name="mycheckbox" id="ne">nepali</li>
          <li><input type="checkbox" name="mycheckbox" id="no">norwegian</li>
          <li><input type="checkbox" name="mycheckbox" id="or">odia</li>
          <li><input type="checkbox" name="mycheckbox" id="ps">pashto</li>
          <li><input type="checkbox" name="mycheckbox" id="fa">persian</li>
          <li><input type="checkbox" name="mycheckbox" id="pl">polish</li>
          <li><input type="checkbox" name="mycheckbox" id="pt">portuguese</li>
          <li><input type="checkbox" name="mycheckbox" id="pa">punjabi</li>
          <li><input type="checkbox" name="mycheckbox" id="ro">romanian</li>
          <li><input type="checkbox" name="mycheckbox" id="ru">russian</li>
          <li><input type="checkbox" name="mycheckbox" id="sm">samoan</li>
          <li><input type="checkbox" name="mycheckbox" id="gd">scots gaelic</li>
          <li><input type="checkbox" name="mycheckbox" id="sr">serbian</li>
          <li><input type="checkbox" name="mycheckbox" id="st">sesotho</li>
          <li><input type="checkbox" name="mycheckbox" id="sn">shona</li>
          <li><input type="checkbox" name="mycheckbox" id="sd">sindhi</li>
          <li><input type="checkbox" name="mycheckbox" id="si">sinhala</li>
          <li><input type="checkbox" name="mycheckbox" id="sk">slovak</li>
          <li><input type="checkbox" name="mycheckbox" id="sl">slovenian</li>
          <li><input type="checkbox" name="mycheckbox" id="so">somali</li>
          <li><input type="checkbox" name="mycheckbox" id="es">spanish</li>
          <li><input type="checkbox" name="mycheckbox" id="su">sundanese</li>
          <li><input type="checkbox" name="mycheckbox" id="sw">swahili</li>
          <li><input type="checkbox" name="mycheckbox" id="sv">swedish</li>
          <li><input type="checkbox" name="mycheckbox" id="tg">tajik</li>
          <li><input type="checkbox" name="mycheckbox" id="ta">tamil</li>
          <li><input type="checkbox" name="mycheckbox" id="te">telugu</li>
          <li><input type="checkbox" name="mycheckbox" id="th">thai</li>
          <li><input type="checkbox" name="mycheckbox" id="tr">turkish</li>
          <li><input type="checkbox" name="mycheckbox" id="uk">ukrainian</li>
          <li><input type="checkbox" name="mycheckbox" id="ur">urdu</li>
          <li><input type="checkbox" name="mycheckbox" id="ug">uyghur</li>
          <li><input type="checkbox" name="mycheckbox" id="uz">uzbek</li>
          <li><input type="checkbox" name="mycheckbox" id="vi">vietnamese</li>
          <li><input type="checkbox" name="mycheckbox" id="cy">welsh</li>
          <li><input type="checkbox" name="mycheckbox" id="xh">xhosa</li>
          <li><input type="checkbox" name="mycheckbox" id="yi">yiddish</li>
          <li><input type="checkbox" name="mycheckbox" id="yo">yoruba</li>
          <li><input type="checkbox" name="mycheckbox" id="zu">zulu</li>
        </ul>
        <div style="padding-top:3px;text-align:right"><input type="button" value="확인" onClick="multiSelect('CLOSE')"></div>
      </div><br><br>
      <label for="email">받을 이메일:</label>
      <input type="email" id="email" name="email">
      <button type="button" id="saveBtn">변환</button>
      <!-- <button type="submit">변환</button> -->
    </form>
    <!-- 로딩바를 표시할 요소 -->
    <div id="loading-bar">aaa</div>
    <img src="/frontend/static/img/1.gif"/>
    <p id="result"></p>
    <div>--------------------------------------------------------------------------------------------------------</div>
    <input type="text" id="massege" name="massege">
    <button type="button" onclick="openaiApiFunc()">자막변환</button>
    <p id="output"></p>
    <script>
      var seqArr = new Array();  //체크박스 seq값 담을 배열변수 하나
      function multiSelect(value){
        seqArr = [];
        if(value=="OPEN") {
          Div.style.visibility="visible";
        }else{
          var checkbox = $("input[name='mycheckbox']:checked");//체크된거 가져오기
          //체크가 되지도 않았는데 이벤트 실행되면 안되니
          if(checkbox.length == 0){ //체크된게 0개 이니까
              alert('체크하세요');
          }else{ //체크 되었으니 
              //체크박스 담을 변수하나
              var chklist = $("input[name='mycheckbox']");
              //먼저 체크박스 길이만큼 반복돌리면서
              for(var i = 0; i < chklist.length; i++){
                if(chklist[i].checked){ //선택되어 있으면 배열에 값을 저장함
                  checkboxTest = chklist[i].getAttribute("id");
                  // console.log(checkboxTest);
                  seqArr.push(chklist[i].getAttribute("id"));
                }
              }
              console.log(seqArr); //값 들어와있나 한번씩 찍어보고 잘들어왔으니
          }
          Div.style.visibility="hidden";
        }
      }
      // const languages = document.querySelector('#languages');
      const selected = document.querySelector('#selected');
      
      function showOptions() {
        // var select = document.getElementById("lang");
        // languages.size = languages.options.length;
      };

      // languages.addEventListener('click', () => {
      //   const options = languages.options;
      //   let selectedLangs = '';
      //   for (let i = 0; i < options.length; i++) {
      //     if (options[i].selected) {
      //       selectedLangs += `${options[i].textContent}, `;
      //     }
      //   }
      //   selected.textContent = selectedLangs.slice(0, -2);
      // });
      function openaiApiFunc() {
        console.log('호출')
        console.log('seqArr: ' + seqArr)
        var massege = $('#massege').val();
        var result = "";
        if (massege === '') {
          alert('massege 비었습니다.')
          return false;
        }
        console.log('massege: ' + massege)
        $.ajax({
          type: 'POST',
          url: 'http://172.16.11.218:5000/api/openai',
          // url: 'http://192.168.200.101:5000/api/openai',
          data: JSON.stringify({'massege': massege, 'languages': seqArr}),
          contentType: "application/json; charset=utf-8", //헤더의 Content-Type을 설정
          async: false, // 동기화 설정
          // dataType: "json", //응답받을 데이터 타입 (XML,JSON,TEXT,HTML,JSONP) 
          beforeSend: function() {
            $("#loading-bar").show(); // AJAX 호출 전에 로딩바를 표시
          },
          success: function(response) {
            console.log('response: ' + response)
            $('#output').text('Analysis response: ' + response);
            result = response; 
          },
          error: function(xhr, status, error) {
            console.log(error);
          },
          complete: function() {
            $('#loading-bar').hide(); // 로딩 화면 숨김
          }
        });
        return result;
      };
      $("#saveBtn").on("click",function(){                                
          $(this).attr("disabled",true);
          $('img').css("display:block")
          $('img').stop().animate({
            'margin-top':'+=100',
            'margin-left': '+=200'
          },1000).delay(2000).animate({
            'margin-top':'-=100',
            'margin-left': '-=200'
          },1000); 
          $(this).attr("disabled",false);
          analyzeText();
      });
      function analyzeText() {
        var inputUrl = $('#video-url').val();
        var inputEmail = $('#email').val();
        var result = "";
        if (inputUrl === '') {
          alert('주소가 비었습니다.')
          return false;
        }
        if (!check()){
          return false
        }
        data = {
          "videoUrl": inputUrl,
          "email": inputEmail,
          'languages': seqArr
        }
        $.ajax({
          type: 'POST',
          url: 'http://172.16.11.218:5000/api/analyze',
          // url: 'http://192.168.200.101:5000/api/analyze',
          data: JSON.stringify(data),
          contentType: "application/json; charset=utf-8", //헤더의 Content-Type을 설정
          // async: false, // 동기화 설정
          dataType: "json", //응답받을 데이터 타입 (XML,JSON,TEXT,HTML,JSONP) 
          beforeSend: function() {
            $("#loading-bar").show(); // AJAX 호출 전에 로딩바를 표시
          },
          success: function(response) {
            console.log('response: ' + response)
            $('#result').text('Analysis response: ' + response);
            result = response; 
          },
          error: function(xhr, status, error) {
            console.log(error);
          },
          complete: function() {
            $('#loading-bar').hide(); // 로딩 화면 숨김
          }
        });
        return result;
      };
 
      function emailSendF() {
        $.ajax({
          url: '/send-email',
          type: 'POST',
          data: {
              from: 'your_email@gmail.com',
              to: 'recipient@example.com',
              subject: 'Hello',
              text: 'Hello world',
          },
          success: function (response) {
              console.log('Email sent successfully');
          },
          error: function (xhr, status, error) {
              console.log('Failed to send email:', error);
          }
        });
      };
      function check() {
        var email = document.getElementById("email");
        if (email.value !== "") {
            var exptext = /^[A-Za-z0-9_\.\-]+@[A-Za-z0-9\-]+\.[A-Za-z0-9\-]+/;
            if (exptext.test(email.value) == false) {
                //이메일 형식이 알파벳+숫자@알파벳+숫자.알파벳+숫자 형식이 아닐경우			
                alert("입력한 메일형식이 올바르지 않습니다.");
                email.focus();
                return false;
            }else{
              return true;
            }
        }else{
          alert('이메일을 입력해주세요.')
          return false;
        }
      }
    </script>
  </body> 
</html>